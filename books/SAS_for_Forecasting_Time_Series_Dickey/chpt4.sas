 /*-------------------------------------------------------------------*/
 /*         SAS FOR FORECASTING TIME SERIES, SECOND EDITION           */
 /*          by John C. Brocklebank and David A. Dickey               */
 /*       Copyright(c) 2003 by SAS Institute Inc., Cary, NC, USA      */
 /*                   SAS Publications order # 57275                  */
 /*  Jointly co-published by SAS Institute and John Wiley & Sons 2003 */
 /*                   SAS ISBN 1-59047-182-2                          */
                John Wiley & Sons, Inc. ISBN 0-471-39566-8            */
 /*-------------------------------------------------------------------*/
 /*                                                                   */
 /* This material is provided "as is" by SAS Institute Inc.  There    */
 /* are no warranties, expressed or implied, as to merchantability or */
 /* fitness for a particular purpose regarding the materials or code  */
 /* contained herein. The Institute is not responsible for errors     */
 /* in this material as it now exists or will exist, nor does the     */
 /* Institute provide technical support for it.                       */
 /*                                                                   */
 /*-------------------------------------------------------------------*/
 /* Questions or problem reports concerning this material may be      */
 /* addressed to the author:                                          */
 /*                                                                   */
 /* SAS Institute Inc.                                                */
 /* Books by Users                                                    */
 /* Attn: John Brocklebank and David Dickey                           */
 /* SAS Campus Drive                                                  */
 /* Cary, NC   27513                                                  */
 /*                                                                   */
 /*                                                                   */
 /* If you prefer, you can send email to:  sasbbu@sas.com             */
 /* Use this for subject field:                                       */
 /*     Comments for John Brocklebank and David Dickey                */
 /*                                                                   */
 /*-------------------------------------------------------------------*/


/************************************/
/*   Chapter 4 data for 4.1-4.3     */
/*                                  */
/************************************/

DATA CONST;
   INPUT ELECTRIC MASONRY CARPENT ROOFERS PAPER HEATING @@;
   RETAIN DATE '01DEC76'd;
   DATE= INTNX("MONTH", DATE, 1);
   CONSTRCT=MASONRY+ELECTRIC;
   FORMAT DATE MONYY5.;
CARDS;
241.9 196.6  77.9  77.0  84.5 318.4 239.3 216.3  78.7  85.7  83.0 318.1
245.5 235.1  82.4  94.7  88.7 326.5 249.6 252.2  87.9 102.8  96.4 337.8
255.7 261.5  92.7 107.8 103.3 348.4 262.8 278.0  99.5 111.0 111.9 359.7
268.1 280.8 103.1 115.6 116.8 370.5 276.1 290.5 106.5 116.4 120.6 374.6
277.1 287.4 103.9 117.7 115.5 374.7 278.6 288.7 105.8 122.4 114.3 376.7
276.2 286.2 102.8 123.5 112.1 377.1 274.6 276.7 101.3 112.5 104.3 376.2
262.1 234.3  91.4  93.1  89.6 361.0 256.2 237.4  84.8  94.2  87.8 350.9
259.9 270.6  93.9 109.7  94.7 362.3 263.6 292.7  98.6 126.1 106.5 375.7
278.0 295.5 103.8 128.7 113.5 384.0 289.5 308.3 113.0 135.5 126.6 399.2
296.6 306.9 115.6 140.3 133.3 413.0 305.1 315.3 115.1 141.3 135.4 423.7
307.8 310.6 110.5 139.2 129.1 423.4 308.2 316.3 110.4 142.0 130.5 425.7
310.1 310.5 107.3 136.7 127.4 423.1 307.6 304.4 105.2 127.7 118.7 420.6
298.2 263.7  97.7 103.4 101.6 396.9 292.1 259.8  96.3  98.4 100.4 388.5
294.5 303.5 102.0 124.1 104.0 395.0 296.9 307.2  98.9 128.9 112.8 398.3
303.3 316.8 101.3 133.5 124.1 407.3 312.1 325.4 103.2 139.2 134.1 416.8
322.8 328.6 107.4 144.0 143.3 425.3 327.7 335.2 107.2 145.9 145.1 430.9
327.0 327.9 106.2 145.6 137.9 426.9 330.4 334.5 105.5 146.3 136.4 426.7
329.7 328.7 100.4 144.9 129.5 424.2 329.5 321.5 101.5 141.1 121.5 421.9
320.3 293.8  91.6 119.8 106.8 409.8 315.7 285.8  89.7 114.6 104.7 398.8
312.6 292.0  88.6 119.0 104.1 394.6 306.5 299.3  86.4 133.9 114.8 388.3
308.6 301.7  88.6 135.7 122.9 390.3 316.3 307.9  80.0 138.1 128.7 396.7
319.5 310.7  93.0 140.1 131.8 395.9 326.4 314.9  96.9 142.9 130.1 405.1
330.8 312.7  95.8 142.9 126.1 407.9 329.3 318.5  96.3 144.7 126.8 410.5
330.6 307.7  94.2 144.2 119.2 406.9 327.2 296.2  93.0 132.6 110.0 399.6
316.2 259.2  84.8 107.4  93.2 388.2 310.1 258.8  80.9 102.0  90.7 379.8
308.5 271.5  84.0 122.0  94.2 378.8 311.1 281.0  92.0 120.4 105.1 382.2
313.6 283.7  95.4 122.1 112.2 379.4 318.3 289.3  95.7 129.2 120.8 389.0
321.3 291.1  95.7 132.6 126.2 393.7 327.4 295.9  96.7 135.7 126.1 397.1
326.7 292.7  92.4 135.4 122.3 393.2 326.4 282.6  88.9 136.4 118.5 393.7
322.5 275.5  84.9 135.9 113.7 387.1 318.6 260.2  80.5 125.2 104.2 379.7
301.9 214.3  70.9  95.8  89.2 363.2 296.1 224.8  71.3  96.0  86.9 354.4
298.3 228.7  73.4 101.6  90.2 350.6 297.7 244.7  76.3 115.0 100.4 351.5
303.5 260.4  83.3 120.2 112.2 358.5 305.0 262.2  85.9 125.3 117.2 362.1
307.6 270.4  85.8 129.4 123.1 367.2 
;
RUN;

/************************************/
/*                                  */
/*        data for 4.4-4.7          */
/*                                  */
/************************************/


DATA AIRLINE;
   INPUT AIR @@;
   LAIR=LOG(AIR);
   TITLE 'SERIES G';
   TITLE2 'INTERNATIONAL AIRLINES PASSENGERS';
   YEAR=INT((_N_-1)/12)+1949;
   MONTH=MOD(_N_-1,12)+1;
   DATE=MDY(MONTH,1,YEAR);
   FORMAT DATE MONYY5.;
   CARDS;
112 118 132 129 121 135 148 148 136 119 104 118
115 126 141 135 125 149 170 170 158 133 114 140
145 150 178 163 172 178 199 199 184 162 146 166
171 180 193 181 183 218 230 242 209 191 172 194
196 196 236 235 229 243 264 272 237 211 180 201
204 188 235 227 234 264 302 293 259 229 203 229
242 233 267 269 270 315 364 347 312 274 237 278
284 277 317 313 318 374 413 405 355 306 271 306
315 301 356 348 355 422 465 467 404 347 305 336
340 318 362 348 363 435 491 505 404 359 310 337
360 342 406 396 420 472 548 559 463 407 362 405
417 391 419 461 472 535 622 606 508 461 390 432
;
RUN;

/************************************/
/*                                  */
/*        data for 4.8-4.12         */
/*                                  */
/************************************/

DATA HOUSING;
   INPUT DATE: YYQ4. DPIC STARTS MORT @@;
   LABEL DPIC='DIS PERS INCOME'
         STARTS='HOUSING STARTS'
         MORT='MORTGAGE RATES'
         SALES='SALES';
   FORMAT DATE YYQ4.;
   T=_N_;
   E=NORMAL(72766133);
   EAR=-.35*EAR1+E-.25*E1;
   IF T=1 THEN EAR=2*NORMAL(72766133);
   NSERR=NSERR+EAR;
   IF T=1 THEN NSERR=EAR;
   DSTART=STARTS-START1;
   DMORT=MORT-MORT1;
   DINC=DPIC-DPIC1;
   DSALES=5*DSTART-250*DMORT+3*DINC+300*EAR;
   SALES=SALES+DSALES;
   IF T=1 THEN SALES=17000;
   OUTPUT;
   RETAIN;
   DPIC1=DPIC;
   START1=STARTS;
   MORT1=MORT;
   EAR1=EAR;
   E1=E;
CARDS;
74Q1  949.5 1628  8.59 74Q2  973.1 1527  8.75 74Q3  999.7 1209  9.08
74Q4 1016.2 1001  9.27 75Q1 1025.4  995  9.17 75Q2 1092.2 1050  8.94
75Q3 1095.7 1258  8.91 75Q4 1124.1 1365  9.01 76Q1 1153.3 1400  8.95
76Q2 1174.1 1428  8.93 76Q3 1193.3 1570  9.02 76Q4 1222.6 1770  9.07
77Q1 1248.0 1756  9.00 77Q2 1285.3 1937  8.96 77Q3 1319.1 2041  9.02
77Q4 1359.6 2146  9.08 78Q1 1398.0 1721  9.20 78Q2 1440.7 2104  9.38
78Q3 1482.1 2044  9.67 78Q4 1531.0 2078  9.91 79Q1 1580.2 1615 10.23
79Q2 1612.8 1815 10.58 79Q3 1663.8 1809 11.05 79Q4 1710.1 1593 11.51
80Q1 1765.1 1263 12.37 80Q2 1784.1 1053 13.53 80Q3 1840.6 1412 12.41
80Q4 1897.0 1535 14.23 81Q1 1947.3 1391 14.56 81Q2 1985.6 1170 15.50
81Q3 2042.0  966 18.00 81Q4 2086.4  903 17.00 82Q1 2115.3  919 17.55
82Q2 2148.9  909 16.37 82Q3 2229.2 1063 16.88 82Q4 2279.6 1239 15.94
83Q1 2323.6 1314 15.76 83Q2 2366.2 1388 15.38 83Q3 2449.8 1377 14.99
83Q4 2497.7 1366 14.78 84Q1 2535.8 1366 15.01 
;
RUN;

DATA END;
   INPUT DATE: YYQ4. STARTS @@;
   FORMAT DATE YYQ4.;
CARDS;
84Q2 1373.2418 84Q3 1387.6686 84Q4 1369.1916 85Q1 1369.1916
85Q2 1371.2554 85Q3 1375.3670 85Q4 1370.1011 86Q1 1370.1011
;
RUN;
DATA COMB;
   SET HOUSING END;
   TITLE 'DATA WITH FORECASTS OF STARTS APPENDED AND SALES=.';
RUN;

/*The following code uses the outputs from the ARIMA statements
  in the book and produces output 4.13 */

PROC GPLOT DATA=FOR2;
   TITLE 'FORECASTING STARTS AND SALES';
   PLOT (SALES U95 FORECAST L95)*DATE/OVERLAY HMINOR=0 VMINOR=0;
   SYMBOL1 V== L=1 I=JOIN;
   SYMBOL2 L=1 I=JOIN V=NONE;
   SYMBOL3 L=1 I=JOIN V=NONE;
   SYMBOL4 L=1 I=JOIN V=NONE;
RUN;

DATA FOR3;
   MERGE FOR2(IN=IN2) FOR1(RENAME=(U95=U952 L95=L952)IN=IN3);
   IF DATE LT '1JAN84'D THEN DO;
      U952=.;
	  L952=.;
   END;
   BY DATE;
RUN;

PROC GPLOT DATA=FOR3;
   TITLE 'FORECASTS AND LIMITS';
   TITLE2 'WITH AND WITHOUT FORECASTED INPUTS';
   PLOT (SALES U95 FORECAST L95 L952 U952)*DATE/OVERLAY HMINOR=0 VMINOR=0;
   SYMBOL1 L=1 I=JOIN V=NONE;
   SYMBOL2 L=1 I=JOIN V=NONE;
   SYMBOL3 L=1 I=JOIN V=NONE;
   SYMBOL4 L=1 I=JOIN V=NONE;
   SYMBOL5 L=3 I=JOIN V=NONE;
   SYMBOL6 L=3 I=JOIN V=NONE;
RUN;
QUIT;

/************************************/
/*                                  */
/*        data for 4.14-4.16        */
/*                                  */
/************************************/


DATA A;
   ONE:T+1;YR=.8*YR1+3*XR2-1.2*XR3+NORMAL(1234567);
   IF YR=. THEN YR=0;
   XR=.5*XR1+NORMAL(1234567);
   IF XR=. THEN XR=0; X=XR+5; Y=YR+10;
   OUTPUT; XR3=XR2;XR2=XR1;XR1=XR;
   YR1=YR; IF T<600 THEN GO TO ONE;
RUN;

DATA A2;
   SET A;
   IF T>100;


DATA TRANSFER;
   SET A2;
   T=T-100;


/************************************/
/*                                  */
/*        data for 4.17-4.19        */
/*                                  */
/************************************/

DATA RIVER;
   TITLE 'FLOW RATES OF NEUSE RIVER AT GOLDSBORO AND KINSTON';
   RETAIN DATE '30SEP70'D;
   INPUT GOLD KINS @@;
   LGOLD=LOG(GOLD);
   LKINS=LOG(KINS);
   DATE=INTNX('DAY',DATE,1);
   FORMAT DATE DATE7.;
CARDS;
  525   548   616   615   361   716   298   555   298   433   160   415
  153   342   182   271   212   280   262   295   160   349   184   289
  143   286   190   265   156   280   146   280   138   286   187   271
  361   262   271   373   316   433   382   471   416   583   539   653
  556   643   429   709   475   646   464   594   367   622   271   562
  528   534   493   759  1030   875  1460  1050  1330  1480  1100  1540
  895  1390   753  1190   620  1020   592   864   606   777   620   852
  810  1000  1520  1140  1810  1520  1880  1880  2060  1990  2250  2100
 1770  2250  1810  2090  1350  1950  1110  1720  1010  1410   912  1260
  808  1160   765  1060   736   997   701   952   696   919   689   887
  605   871   591   811   702   751   619   826   563   821   613   738
  612   752   593   768   573   751   562   738   539   723   509   704
  523   676   574   655   512   687   488   682   640   652   962   878
 1150  1240  1710  1360  1770  1670  1600  1880  1390  1830  1400  1690
 1540  1710  1790  1800  2050  1910  2120  2100  1890  2230  1700  2160
 1360  1940  1210  1700  1130  1550  1110  1450  1190  1380  1350  1410
 1490  1520  1730  1640  2770  1830  3500  2620  4000  3080  4400  3610
 4900  4110  5420  4560  5480  5000  5130  5380  4560  5820  3870  5990
 3230  5800  2750  5230  2470  4490  2200  3790  1980  3210  1800  2760
 1690  2460  1900  2310  2540  2580  3130  3040  3560  3420  3670  3780
 3370  4040  2880  4150  2750  4220  2820  4140  3130  4050  3320  3970
 3250  4050  3300  4160  3740  4270  4660  4430  5560  4740  6480  5310
 7200  5950  7870  6480  8630  7000  9510  7830 10300  8670 10700  9350
10600 10100 10300 10700  9770 11000  8970 11100  7570 10800  5990 10200
 4290  9380  4630  8450  5540  7460  6440  6860  7040  6670  7070  6860
 6070  7200  4750  7460  4230  7390  5560  7370  7790  8220  8410  9170
 9400  9300 10400  9510 11400 10000 12200 10700 12300 11500 11800 12400
10700 12900  8570 13000  6260 12500  4080 11300  3500  9070  3410  7010
 3530  5530  3560  4930  3280  5620  2810  4280  2520  3940  2350  3480
 2230  3090  2040  2850  2080  2710  2470  2760  2940  2980  3300  3240
 3900  3560  4510  3920  4930  4320  5190  4770  5360  5200  5080  5560
 3930  5770  4450  5980  5280  5950  6020  6110  6580  6390  6880  6670
 6930  6940  6850  7130  6640  7250  5700  7260  3930  7140  2700  6790
 2350  5530  2060  4160  1840  3160  1690  2660  1560  2260  1600  2060
 1630  1990  1620  2020  1670  2010  1620  1990  1530  1970  1700  1980
 2030  2220  2670  2390  3070  2660  3040  3000  2630  3230  2130  3190
 1850  2830  1600  2350  1360  2000  1240  1730  1180  1540  1100  1440
 1110  1350  0999  1310  1120  1300  1220  1460  2160  1560  2760  2210
 3020  2750  3550  3070  3910  3330  4110  3620  4280  4100  4240  4430
 3620  4450  1900  4370  1370  3520  1180  2110  1030  1520   902  1310
  874  1410  1070  1270  1910  1270  2580  1760  3000  2280  3170  2700
 3350  2940  2880  3110  1490  3180  1020  2320   846  1360   782  1060
  711   946   525   872   630   732   753   764   634   856   634   804
  651   753   623   773   623   763   641   757   683   756   634   779
  578   766   606   844   571   975   588   826   585   758   634   747
  585   762   477   729   407   649   394   580   519   561   842   675
  606   972   560   821   439   722   616   680   749   897   854  1030
  918   999   854  1110  1030  1080  1190  1140   942  1260   627  1160
  532   855   442   708   400   627   314   552   362   506   445   524
  455   588   690   596   752   690   602   825   458   768   388   722
  506   688   602   699  1350   720  1480  1250  1370  1550  1140  1580
  914  1410   814  1170   763   987   588   921   850   784  1090   828
  926  1080   606  1050   529   830   483   670   423   625   350   574
  347   511   445   535   543   718   602   995   609  1090   806   954
  874   968   763  1060   676   997   496   920   648   773   858   779
  958  1030   822  1330   954  1360  1040  1300  1430  1300  1520  1480
 1000  1670   641  1370   557   998   435   807   338   715   296   603
  376   553   474   570   423   654   359   672   376   703   407   939
  439   926  1620   728  2310  1340  2590  2030  2370  2420  1090  2480
  651  1660   451  1060   496   883   464   697   557   648   539   634
  529   658   416   641   376   578   362   504   567   655   790  1840
  906  2360  2400  2680  3470  3080  4040  3580  4420  3990  4490  4350
 4420  4560  4400  4700  4630  4890  4920  5130  5110  5470  5240  5680
 5180  5710  5060  5710  5040  5660  5020  5600  4820  5530  3420  5440
 2070  5240  1650  4250  1530  3410  2330  3740  3470  4440  4600  5130
 5330  5380  6140  5630  6870  5990  7470  6420  7830  6860  7890  7330
 7720  7780  7580  8100  7630  8320  7580  8280 
;
RUN;

/************************************/
/*                                  */
/*        data for 4.20             */
/*                                  */
/************************************/

DATA CATLG;
   ONE:
   T+1; X=0; IF T>20 THEN X=1; Y1=.7*Y11+3*X; IF Y1=. THEN Y1=0;
   Y2=-.7*Y21+3*X; IF Y2=. THEN Y2=0; Y3=3*(X-.7*X1); IF Y3=. THEN Y3=0;
   Y4=3*(X+.7*X1+.5*X2); IF Y4=. THEN Y4=0; Y5=-3*(X+.7*X1+.5*X2);
   IF Y5=. THEN Y5=0; Y6=Y61+X; Y7=Y71-.2*X; IF Y6=. THEN Y6=0;
   IF Y7=. THEN Y7=0; Y8=.8*Y81-.64*Y82+2*X; IF Y8=. THEN Y8=0;
   Y9=.7*Y94+3*X; IF Y9=. THEN Y9=0; Y10=.8*Y101-3*X+4*X1;
   IF Y10=. THEN Y10=0;
   OUTPUT;
   RETAIN;
   Y11=Y1; Y21=Y2; Y61=Y6; Y71=Y7; Y82=Y81; Y81=Y8; Y94=Y93; Y93=Y92;
   Y92=Y91; Y91=Y9; Y101=Y10;
   X2=X1; X1=X;
   IF T < 50 THEN GO TO ONE;
RUN;

/************************************/
/*                                  */
/*        data for 4.21-4.25        */
/*                                  */
/************************************/

 /************************************************************/
 /* SOURCE: MCSWEENY, A.J. "THE EFFECTS OF RESPONSE COST ON  */
 /* THE BEHAVIOR OF A MILLION PERSONS: CHARGING FOR DIRECTORY*/
 /* ASSISTANCE IN CINCINNATI." JOURNAL OF APPLIED BEHAVIORAL */
 /* ANALYSIS, 11, 47-51.                                     */
 /************************************************************/

DATA CALLS;
TITLE 'DIRECTORY ASSISTANCE';
TITLE2 'MONTHLY AVERAGE CALLS PER DAY';
   RETAIN DATE '01DEC61'D;
   INPUT CALLS @@; 
   DATE=INTNX('month',date,1);
   FORMAT DATE MONYY5.;
   IMPACT1=(DATE>='01MAR74'D);  * <-- actual fee date ;
   IMPACT=(DATE>='01FEB74'D);  * <-- picks up anticipation ;
 
   TREND = TREND +  2.32863  
             -123.18861*(IMPACT-LAG(IMPACT)) 
            - 400.69122*(LAG(IMPACT)-LAG2(IMPACT)); 
   IF TREND=. THEN TREND=CALLS; ** MODEL IS FOR DIFFERENCES - START AT OBSERVED**;
   RETAIN TREND;

CARDS;
350 339 351 364 369 331 331 340 346 341 357 398
381 367 383 375 353 361 375 371 373 366 382 429
406 403 429 425 427 409 402 409 419 404 429 463
428 449 444 467 474 463 432 453 462 456 474 514
489 475 492 525 527 533 527 522 526 513 564 599
572 587 599 601 611 620 579 582 592 581 630 663
638 631 645 682 601 595 521 521 516 496 538 575
537 534 542 538 547 540 526 548 555 545 594 643
625 616 640 625 637 634 621 641 654 649 662 699
672 704 700 711 715 718 652 664 695 704 733 772
716 712 732 755 761 748 748 750 744 731 782 810
777 816 840 868 872 811 810 762 634 626 649 697
657 549 162 177 175 162 161 165 170 172 178 186
178 178 189 205 202 185 193 200 196 204 206 227
225 217 219 236 253 213 205 210 216 218 235 241
;
RUN;

/************************************/
/*                                  */
/*        data for 4.26-4.30        */
/*                                  */
/************************************/

DATA NCRETAIL;
   INPUT T SALES @@;
   SALES = ROUND(SALES /1000000,.01);
   ARRAY S(12); 
   TITLE 'NORTH CAROLINA RETAIL SALES IN MILLION $';
   TITLE2 'MONTHLY, STARTING JAN 1983';
   DATE = INTNX('MONTH','01JAN83'D,T-1);
   FORMAT DATE MONYY.;
   MONTH=MONTH(DATE);
   DO I=1 TO 12; S(I)=(MONTH=I); END; 
   QTR = QTR(DATE);
   YEAR=YEAR(DATE);
CARDS;

   1    3015233240   2    2955239916   3    3515214728   4    3542214765
   5    3760171602   6    3861710890   7    3948119154   8    3857400765
   9    3991808107  10    3948837758  11    3921635986  12    4589204139
  13    3582540514  14    3593985541  15    3999557560  16    4140218132
  17    4281220370  18    4432775221  19    4159835215  20    4315634965
  21    4148268958  22    4298093629  23    4198142376  24    4865188861
  25    3822276523  26    3738759522  27    4172822522  28    4499215432
  29    4659777577  30    4712862641  31    5138285448  32    4552951360
  33    4629119174  34    4407727513  35    4480340715  36    5092533750
  37    4168979178  38    3758286873  39    4762263293  40    4836162269
  41    4563588932  42    4952266631  43    4914763054  44    4817538596
  45    4898717646  46    4238335573  47    5053206004  48    5259807722
  49    3831340056  50    4195136895  51    4814880192  52    5056575931
  53    5014523206  54    5350107966  55    5199749767  56    5137618567
  57    5092012083  58    5021674707  59    5230130577  60    5513206337
  61    4365582516  62    4763441579  63    5421186857  64    5304659927
  65    5414260129  66    5567846625  67    5284476010  68    5609751909
  69    5408956886  70    5410544436  71    5480087886  72    5938593773
  73    4739957101  74    4892357822  75    5510490235  76    5528040726
  77    5759246907  78    5849332089  79    5606143536  80    5767758001
  81    5523094676  82    5204967070  83    5356075563  84    5755816787
  85    5740884501  86    4764878261  87    4350542761  88    5330998336
  89    5440514664  90    5534389517  91    5296402425  92    5432986126
  93    5381120395  94    5507066162  95    5428411250  96    5686731051
  97    4848427291  98    4527984507  99    5348286416 100    5499316297
 101    5547571463 102    5537091238 103    5476273000 104    5545760000
 105    5342833000 106    5189157303 107    5884632993 108    5939546709
 109    5092972858 110    5024931153 111    5487910805 112    5839360817
 113    5762005354 114    6006131480 115    5994432994 116    5816598976
 117    6020755821 118    5374133502 119    6236755808 120    6226614995
 121    5413204686 122    5741224957 123    6006012812 124    5949198302
 125    6439172197 126    6534264382 127    6428879136 128    6332846966
 129    6597102019 130    6174000990 131    6549795335 132    7107194675
 133    5588577234 134    6386696014 135    6790093648 136    6665606199
 137    6874612107 138    7046904256 139    6981728317 140    6937376730
 141    7211616880 142    7365763115 143    6758181964 144    8533735305
 145             . 146             . 147             . 148             .
 149             . 150             . 151             . 152             .
 153             . 154             . 155             . 156             .
 157             . 158             . 159             . 160             .
 161             . 162             . 163             . 164             .
 165             . 166             . 167             . 168             .
;
run;

/************************************/
/*                                  */
/*        data for 4.31-4.32        */
/*                                  */
/************************************/

DATA CONST;
   INPUT ELECTRICIANS MASONS CARPENTERS ROOFERS
         PAPERERS HEATING @@; 
   RETAIN DATE '01DEC76'd;
   DATE= INTNX("MONTH", DATE, 1);
   FORMAT DATE MONYY.; 
   CONSTRCT = MASONS+ELECTRICIANS;
   ARRAY S(12); 
   DO I=1 TO 12; S(I)=MONTH(DATE)=I; END; 
CARDS;
241.9 196.6  77.9  77.0  84.5 318.4 239.3 216.3  78.7  85.7  83.0 318.1
245.5 235.1  82.4  94.7  88.7 326.5 249.6 252.2  87.9 102.8  96.4 337.8
255.7 261.5  92.7 107.8 103.3 348.4 262.8 278.0  99.5 111.0 111.9 359.7
268.1 280.8 103.1 115.6 116.8 370.5 276.1 290.5 106.5 116.4 120.6 374.6
277.1 287.4 103.9 117.7 115.5 374.7 278.6 288.7 105.8 122.4 114.3 376.7
276.2 286.2 102.8 123.5 112.1 377.1 274.6 276.7 101.3 112.5 104.3 376.2
262.1 234.3  91.4  93.1  89.6 361.0 256.2 237.4  84.8  94.2  87.8 350.9
259.9 270.6  93.9 109.7  94.7 362.3 263.6 292.7  98.6 126.1 106.5 375.7
278.0 295.5 103.8 128.7 113.5 384.0 289.5 308.3 113.0 135.5 126.6 399.2
296.6 306.9 115.6 140.3 133.3 413.0 305.1 315.3 115.1 141.3 135.4 423.7
307.8 310.6 110.5 139.2 129.1 423.4 308.2 316.3 110.4 142.0 130.5 425.7
310.1 310.5 107.3 136.7 127.4 423.1 307.6 304.4 105.2 127.7 118.7 420.6
298.2 263.7  97.7 103.4 101.6 396.9 292.1 259.8  96.3  98.4 100.4 388.5
294.5 303.5 102.0 124.1 104.0 395.0 296.9 307.2  98.9 128.9 112.8 398.3
303.3 316.8 101.3 133.5 124.1 407.3 312.1 325.4 103.2 139.2 134.1 416.8
322.8 328.6 107.4 144.0 143.3 425.3 327.7 335.2 107.2 145.9 145.1 430.9
327.0 327.9 106.2 145.6 137.9 426.9 330.4 334.5 105.5 146.3 136.4 426.7
329.7 328.7 100.4 144.9 129.5 424.2 329.5 321.5 101.5 141.1 121.5 421.9
320.3 293.8  91.6 119.8 106.8 409.8 315.7 285.8  89.7 114.6 104.7 398.8
312.6 292.0  88.6 119.0 104.1 394.6 306.5 299.3  86.4 133.9 114.8 388.3
308.6 301.7  88.6 135.7 122.9 390.3 316.3 307.9  80.0 138.1 128.7 396.7
319.5 310.7  93.0 140.1 131.8 395.9 326.4 314.9  96.9 142.9 130.1 405.1
330.8 312.7  95.8 142.9 126.1 407.9 329.3 318.5  96.3 144.7 126.8 410.5
330.6 307.7  94.2 144.2 119.2 406.9 327.2 296.2  93.0 132.6 110.0 399.6
316.2 259.2  84.8 107.4  93.2 388.2 310.1 258.8  80.9 102.0  90.7 379.8
308.5 271.5  84.0 122.0  94.2 378.8 311.1 281.0  92.0 120.4 105.1 382.2
313.6 283.7  95.4 122.1 112.2 379.4 318.3 289.3  95.7 129.2 120.8 389.0
321.3 291.1  95.7 132.6 126.2 393.7 327.4 295.9  96.7 135.7 126.1 397.1
326.7 292.7  92.4 135.4 122.3 393.2 326.4 282.6  88.9 136.4 118.5 393.7
322.5 275.5  84.9 135.9 113.7 387.1 318.6 260.2  80.5 125.2 104.2 379.7
301.9 214.3  70.9  95.8  89.2 363.2 296.1 224.8  71.3  96.0  86.9 354.4
298.3 228.7  73.4 101.6  90.2 350.6 297.7 244.7  76.3 115.0 100.4 351.5
303.5 260.4  83.3 120.2 112.2 358.5 305.0 262.2  85.9 125.3 117.2 362.1
307.6 270.4  85.8 129.4 123.1 367.2 
;
RUN;
DATA PLUS; 
   ARRAY S(12); 
   DO T=1 TO 36; DATE = INTNX('MONTH','01JUL82'D,T); 
   DO I=1 TO 12; S(I)=MONTH(DATE)=I; END; 
   OUTPUT; END; 
DATA ALL; SET CONST PLUS; 
RUN;

/*The following code uses the outputs from the ARIMA statements
  in the book and produces output 4.31*/

DATA GRAPH; 
  MERGE OUTDUM(RENAME=(L95=LDUM U95=UDUM FORECAST=FDUM))
        OUTF  (RENAME=(L95=LDIF U95=UDIF FORECAST=FDIF));
  BY DATE; IF CONSTRCT NE . THEN DO; 
  LDUM=.; UDUM=.; LDIF=.; UDIF=.; FDUM=.; FDIF=.; END;
  OUTPUT; 
  IF DATE = '01JUL84'D THEN DO ; DATE=DATE+50;
   LDUMA=LDUM; UDUMA=UDUM; FDUMA=FDUM; 
   LDUM=.;UDUM=.; FDUM=.;
   LDIFA=LDIF; UDIFA=UDIF; FDIFA=FDIF; 
   LDIF=.; UDIF=.;  FDIF=.;
  END; OUTPUT; 
PROC GPLOT; 
   PLOT (CONSTRCT FDUM  LDUM  UDUM  FDIF  LDIF  UDIF
                 FDUMA LDUMA UDUMA FDIFA LDIFA UDIFA)*DATE/OVERLAY HMINOR=0 VMINOR=0;
      SYMBOL1 V=NONE I=JOIN C=GRAYA0 R=3;
      SYMBOL2 V=NONE I=JOIN C=BLACK W=2 R=3; 
      SYMBOL3 V=DOT I=NONE C=GRAYA0 R=3; 
      SYMBOL4 V='D' I=NONE C=BLACK R=3; 
RUN;
QUIT; 


/************************************/
/*                                  */
/*        data for 4.33-4.35        */
/*                                  */
/************************************/

/*-----------------------------------------------------------
 |  Data from Shipping Liu.  Sales of milk in Hawaii.  In April |
 |  of '82 news of milk contamination was released.  Sales fell |
 |  and bottomed out in May then returned toward the previous   |
 |  level slowly.                                               |
 |  During March and April of 1982, 8 milk recalls were issued  |
 |  and 36.2 million pounds of contaminated milk were           |
 |  discovered on Oahu.  The contaminant was heptachlor         |
 |  pesticide whcih is applied to pineapple trees.              |
 |                                                              |
 | Liu, Shiping, J. Huang, and G. L. Brown "Information and     |
 | Risk Perception:  A Dynamic Adjustment Process"  (1988)      |
 | Risk Analysis, 18, pg. 689-699                               |
 |____________________________________________________________*/

DATA LIU;
   INPUT DDDD $ SALES @@;
   SALES=SALES/100000;
   RETAIN DATE '01JAN77'D;
   DATE=INTNX('MONTH',DATE,1);
   FORMAT DATE MONYY.;
   LABEL SALES = 'milk sales /100000';
   TITLE 'EFFECT OF NEGATIVE PUBLICITY (CONTAMINATION)';
   TITLE2 'ON MILK SALES';

   ** point intervention level shift ***; 
   X = (DATE='01APR82'D);
   LEVEL1 = (DATE<'01APR82'D);

   ** point invervention - fitted trend **;
   IF X=1 THEN EFFECT1 = -31.896; 
   IF DATE<'01APR82'D THEN EFFECT1=0; 
   IF DATE>'01APR82'D THEN EFFECT1 = .61051*EFFECT1 -49.56*(DATE='01MAY82'D);  
   TREND1 = 83.0155 + EFFECT1; DROP EFFECT1; RETAIN EFFECT1;

   ** point invervention plus level shift - fitted trend **; 
   IF X=1 THEN EFFECT2 = -31.67677; 
   IF DATE<'01APR82'D THEN EFFECT2=0; 
   IF DATE>'01APR82'D THEN EFFECT2 = .56565*EFFECT2 -48.5545*(DATE='01MAY82'D);  
   TREND2 = 75.955 +10.791*LEVEL1 + EFFECT2; DROP EFFECT2; RETAIN EFFECT2; 

   IF '01FEB82'D < DATE < '01JUN82'D THEN DOT = SALES; ELSE DOT=.;  

   CARDS;

FEB77  9331400  MAR77  8366100  APR77  9357500  MAY77  8674600
JUN77  9106200  JUL77  7522500  AUG77  7797800  SEP77  7980700
OCT77  9436400  NOV77  9170500  DEC77  9060600  JAN78  8414700
FEB78  9207000  MAR78  8124600  APR78  9216900  MAY78  9310700
JUN78  9406200  JUL78  8004100  AUG78  8062200  SEP78  8322100
OCT78  9353400  NOV78  9432600  DEC78  9060100  JAN79  9041600
FEB79  9385200  MAR79  8666200  APR79  9721700  MAY79  9416400
JUN79  9523700  JUL79  8601100  AUG79  8442400  SEP79  8583800
OCT79  8883600  NOV79  9076300  DEC79  8267200  JAN80  9248300
FEB80  9470800  MAR80  9289600  APR80  9563500  MAY80  9462900
JUN80  9603800  JUL80  8216000  AUG80  8413300  SEP80  8525200
OCT80  9012400  NOV80  9297300  DEC80  8717500  JAN81  8524000
FEB81  9212700  MAR81  8415200  APR81  8565100  MAY81  9164100
JUN81  9293100  JUL81  7892100  AUG81  8345700  SEP81  8249400
OCT81  8884000  NOV81  8938400  DEC81  8186200  JAN82  8265100
FEB82  8483400  MAR82  7768100  APR82  4443700  MAY82  1460800
JUN82  4119000  JUL82  5342600  AUG82  5913000  SEP82  6098000
OCT82  6587700  NOV82  7344500  DEC82  7081900  JAN83  7199700
FEB83  7642900  MAR83  6960400  APR83  8446100  MAY83  8075100
JUN83  8367600  JUL83  6906300
;
RUN;

/************************************/
/*                                  */
/*        data for 4.36             */
/*                                  */
/************************************/

/*Source: 
http://markets.forbes.com/forbesrpt/Historical_Quotes.html?Format=0&sort=|Date&Symbol=AMR/ */

DATA AMERICAN;
  * AMR Corporation stocks (American Airlines); 
   INPUT DATE :DATE7. OPEN HIGH LOW CLOSE VOLUME;
   CARDS;
     11OCT01    20.950    22.230    20.950    22.200     2116900
     10OCT01    20.160    21.040    20.000    20.750     2020900
     09OCT01    21.210    21.210    20.040    20.160     2680600
     08OCT01    20.150    21.600    19.850    21.200     1797600
     05OCT01    21.150    21.750    20.210    20.860     1537500
     04OCT01    22.800    22.800    21.010    21.150     2696500
     03OCT01    20.680    22.340    20.510    22.120     2486200
     02OCT01    20.000    20.990    20.000    20.670     2380600
     01OCT01    19.150    20.000    19.150    19.900     2275900
     28SEP01    18.090    19.500    18.090    19.140     3070200
     27SEP01    18.350    18.590    17.700    17.900     2151000
     26SEP01    18.700    19.130    18.140    18.240     1378300
     25SEP01    18.500    19.600    18.400    18.640     3049800
     24SEP01    19.250    19.700    18.050    18.300     3768300
     21SEP01    17.250    18.750    16.900    17.900     5361700
     20SEP01    20.100    20.250    18.400    18.450     3226800
     19SEP01    20.940    21.000    18.800    20.000     5638800
     18SEP01    18.780    20.930    18.780    20.000     7705700
     17SEP01    16.000    19.950    15.900    18.000    17166100
     14SEP01    29.700    29.700    29.700    29.700           .
     13SEP01    29.700    29.700    29.700    29.700           .
     12SEP01    29.700    29.700    29.700    29.700           .
     11SEP01    29.700    29.700    29.700    29.700           .  <- Terrorists attack WTC
     10SEP01    29.950    29.990    29.250    29.700     1314000
     07SEP01    30.700    31.100    29.590    30.150     1661300
     06SEP01    31.450    31.620    31.050    31.150      841500
     05SEP01    32.150    32.150    31.460    31.990      752900
     04SEP01    32.010    32.760    31.880    32.280      812700
     31AUG01    32.400    32.400    31.880    31.990      500100
     30AUG01    32.650    32.840    31.930    32.320      579000
     29AUG01    33.260    33.300    32.200    32.650      957000
     28AUG01    33.550    33.700    32.800    33.260      808000
     27AUG01    33.650    33.890    33.330    33.550      331900
     24AUG01    32.970    34.180    32.660    33.880      516600
     23AUG01    32.100    32.740    32.050    32.720      386300
     22AUG01    32.250    32.550    31.670    32.400      683800
     21AUG01    33.130    33.280    32.100    32.130      547600
     20AUG01    32.450    33.350    32.270    33.320      809800
     17AUG01    32.950    33.000    32.210    32.460      631900
     16AUG01    33.050    33.400    32.540    33.170      529700
     15AUG01    33.850    33.880    33.010    33.410      441000
     14AUG01    33.800    34.140    33.400    33.730      887400
     13AUG01    33.870    34.090    33.250    33.590      510000
     10AUG01    33.250    34.290    33.000    34.200      784700
     09AUG01    33.810    33.860    32.800    33.030      963600
     08AUG01    34.240    34.650    34.000    34.060      713900
     07AUG01    34.110    34.350    33.570    34.230      761500
     06AUG01    34.350    34.900    34.300    34.450      635300
     03AUG01    35.000    35.050    34.350    34.840      442700
     02AUG01    36.000    36.000    34.860    35.370      863700
     01AUG01    35.150    36.250    34.760    36.230      857300
     31JUL01    34.950    35.590    34.430    35.150      805100
     30JUL01    35.050    35.450    34.790    35.240      431200
     27JUL01    35.650    35.750    34.800    34.800      604300
     26JUL01    35.550    35.910    35.170    35.810      557800
     25JUL01    35.800    35.980    35.400    35.550      731600
     24JUL01    35.970    36.290    35.500    35.800      889200
     23JUL01    36.000    36.400    35.950    36.180      819000
     20JUL01    36.180    36.200    35.900    36.070      482300
     19JUL01    36.000    36.620    35.810    36.170     1207500
     18JUL01    35.650    36.000    35.020    35.440     1638200
     17JUL01    37.150    37.250    35.920    36.400     1392500
     16JUL01    38.000    38.400    37.090    37.260     1058800
     13JUL01    37.440    37.940    37.230    37.940      729200
     12JUL01    36.700    37.750    36.300    37.640      833900
     11JUL01    35.800    36.580    35.750    36.450      609700
     10JUL01    36.150    36.410    35.740    35.830      416200
     09JUL01    35.200    36.100    35.170    36.070      772700
     06JUL01    36.750    36.750    35.010    35.430      945700
     05JUL01    36.920    37.100    35.760    36.800     1054400
     03JUL01    35.880    37.150    35.870    36.670      864200
     02JUL01    35.870    36.460    35.430    36.000     1042300
     29JUN01    35.000    36.220    34.700    36.130     1116100
     28JUN01    34.600    35.620    34.600    35.200     1640600
     27JUN01    32.900    34.370    32.900    34.270     1828600
     26JUN01    32.500    33.430    32.500    33.400     1340000
     25JUN01    34.000    34.000    32.780    33.240     1258400
     22JUN01    34.900    34.900    34.020    34.360      603000
     21JUN01    34.350    34.990    33.880    34.950     1029600
     20JUN01    34.000    34.400    33.580    34.390     1401700
     19JUN01    35.000    35.000    33.680    34.400     1734700
     18JUN01    35.280    36.060    35.270    35.920      519700
     15JUN01    35.010    35.570    34.750    35.280     1043200
     14JUN01    35.850    36.060    35.150    35.570      659800
     13JUN01    35.850    36.360    35.770    36.050      500100
     12JUN01    36.360    36.360    35.810    36.100      479000
     11JUN01    37.390    37.450    36.710    36.760      570700
     08JUN01    37.400    37.600    37.250    37.380      243100
     07JUN01    37.400    37.900    37.340    37.800      743000
     06JUN01    38.000    38.280    37.750    37.850     1149800
     05JUN01    37.710    38.160    37.450    38.160      598200
     04JUN01    37.500    37.710    37.420    37.710      644500
     01JUN01    38.900    38.910    37.610    37.630     1034900
     31MAY01    37.950    39.150    37.800    38.990     1028000
     30MAY01    38.150    38.240    37.800    37.920      866600
     29MAY01    37.810    38.630    37.450    38.290      797000
     25MAY01    37.100    38.170    37.050    37.800     1854500
     24MAY01    38.300    38.500    37.700    37.820      968100
     23MAY01    39.380    39.380    38.450    38.550     1010200
     22MAY01    38.900    39.500    38.750    39.380     1408500
     21MAY01    38.000    38.600    38.000    38.500     1124600
     18MAY01    37.060    38.100    37.050    37.920     1092400
     17MAY01    36.350    37.200    36.350    37.050      829900
     16MAY01    36.700    36.740    35.650    36.150     5360100
     15MAY01    37.060    37.250    36.940    37.010      733500
     14MAY01    37.450    37.450    36.650    37.050      505500
     11MAY01    37.500    37.530    37.050    37.060     1346800
     10MAY01    37.550    37.800    37.200    37.450      963200
     09MAY01    37.650    37.680    37.300    37.470      502200
     08MAY01    37.900    38.000    37.700    37.840      664200
     07MAY01    37.650    38.050    37.650    37.900      905500
     04MAY01    38.000    38.290    37.700    37.900      726800
     03MAY01    38.800    39.200    38.360    38.500     1277000
     02MAY01    37.920    38.940    37.680    38.800     1062500
     01MAY01    38.000    38.150    37.730    37.920      640000
     30APR01    38.000    38.380    37.550    38.110     1016300
     27APR01    37.450    38.110    37.450    37.740      778500
     26APR01    36.650    37.850    36.600    37.520      932200
     25APR01    37.000    37.280    36.610    37.040      695400
     24APR01    38.870    38.870    37.300    37.660     1125100
     23APR01    39.000    39.200    38.550    38.930     1831200
     20APR01    39.000    39.090    38.540    39.010     1472900
     19APR01    37.450    39.250    37.380    39.200     1556300
     18APR01    35.000    37.900    35.000    37.860     1475500
     17APR01    34.550    35.000    34.180    35.000      806200
     16APR01    34.950    35.300    34.320    34.600      895200
     12APR01    34.900    35.200    34.000    35.200      708900
     11APR01    35.700    35.850    34.500    35.300     1059900
     10APR01    34.300    36.450    33.890    36.050     1454600
     09APR01    33.950    34.500    33.750    33.940      904400
     06APR01    35.250    35.250    33.700    33.970      721000
     05APR01    35.200    35.720    34.810    35.050     1325100
     04APR01    34.000    35.000    33.350    34.950     1205000
     03APR01    34.000    34.440    33.100    33.740      894200
     02APR01    34.500    34.980    33.950    34.080     1009200
     30MAR01    34.650    35.120    33.520    35.120      660300
     29MAR01    34.830    35.450    34.380    34.520      633700
     28MAR01    36.000    36.040    34.600    34.820     1194700
     27MAR01    35.270    36.680    35.100    36.480      947700
     26MAR01    33.550    35.400    33.100    35.270     1304700
     23MAR01    33.750    33.750    33.000    33.110     1461500
     22MAR01    34.050    34.090    33.000    33.850     1253500
     21MAR01    34.000    34.300    34.000    34.120     1284300
     20MAR01    34.050    34.500    34.000    34.110      854000
     19MAR01    34.000    34.060    33.800    34.050     1794100
     16MAR01    34.100    34.300    33.780    33.790     1269000
     15MAR01    33.000    34.680    32.710    34.540     2441900
     14MAR01    33.900    33.910    32.170    32.810     2203400
     13MAR01    34.810    34.900    33.190    34.300     2470600
     12MAR01    36.000    36.100    34.700    34.810     1458200
     09MAR01    36.000    36.600    35.650    36.450     1380300
     08MAR01    35.700    36.760    35.170    36.700     1495000
     07MAR01    34.960    35.430    34.640    35.000     1221100
     06MAR01    34.650    35.000    34.070    34.960      906100
     05MAR01    33.000    34.150    33.000    33.950      759600
     02MAR01    32.900    33.550    31.900    33.280     2256800
     01MAR01    32.000    32.100    31.010    31.320     2814200
     28FEB01    33.500    33.500    32.200    33.250      980200
     27FEB01    33.550    33.850    33.020    33.410     1916600
     26FEB01    32.300    34.250    32.260    33.070     1132700
     23FEB01    32.250    32.300    31.600    31.700     1630000
     22FEB01    31.060    32.500    31.060    32.250     1796900
     21FEB01    31.000    31.250    30.700    31.060     2272700
     20FEB01    33.000    33.000    30.800    31.100     3397900
     16FEB01    33.570    33.700    33.000    33.180     1134100
     15FEB01    32.750    33.970    32.750    33.370     2103800
     14FEB01    33.700    33.750    32.500    32.500     1990400
     13FEB01    34.000    34.050    33.450    33.800     1385000
     12FEB01    34.700    34.950    33.800    34.000     2716400
     09FEB01    35.300    35.300    34.430    34.610      921900
     08FEB01    36.350    36.490    34.620    34.850     1597000
     07FEB01    36.990    37.240    36.100    36.350     1306400
     06FEB01    37.100    38.450    36.950    36.950      604500
     05FEB01    38.800    38.800    37.500    37.500      680200
     02FEB01    39.000    39.000    38.000    38.580     1445000
     01FEB01    39.150    39.600    37.950    39.600      984600
     31JAN01    38.260    39.750    38.050    39.090     1437200
     30JAN01    36.900    38.350    36.600    38.250     1712100
     29JAN01    36.850    37.200    36.700    36.970     1110700
     26JAN01    37.000    37.310    36.500    36.750     1404800
     25JAN01    37.000    37.875    36.937    37.375     1174400
     24JAN01    37.687    37.937    36.500    37.125     1779100
     23JAN01    36.375    38.312    36.375    38.125     1161200
     22JAN01    37.375    37.500    36.312    36.625     1557500
     19JAN01    38.062    38.562    37.312    37.375     1437400
     18JAN01    37.000    38.312    36.875    38.062     1494400
     17JAN01    37.375    38.000    36.625    37.000     1571000
     16JAN01    36.812    38.312    36.750    37.687     1174600
     12JAN01    38.437    38.437    36.812    36.812      924000
     11JAN01    39.500    39.625    38.250    38.437     1330800
     10JAN01    38.375    39.250    37.250    38.687     2481200
     09JAN01    40.625    40.625    38.125    38.937     3280500
     08JAN01    42.750    43.125    40.000    41.500     4881700
     05JAN01    42.750    43.937    41.750    43.750     3780900
     04JAN01    41.500    43.250    40.687    43.062     3334100
     03JAN01    38.250    41.750    36.812    41.625     2470300
     02JAN01    38.625    39.937    38.500    38.687     1708900
     29DEC00    37.437    39.437    37.437    39.187     1588400
     28DEC00    37.625    37.687    36.687    37.375      965400
     27DEC00    35.000    37.937    35.000    37.875      895900
     26DEC00    36.250    36.250    35.125    35.875      566100
     22DEC00    36.000    36.500    35.375    35.937     1610800
     21DEC00    36.500    36.937    35.500    35.500     1459300
     20DEC00    34.687    36.500    33.750    36.000     1996100
     19DEC00    37.000    37.125    34.875    35.062     1295200
     18DEC00    35.812    37.187    35.437    36.562     1869000
     15DEC00    36.000    36.312    35.125    35.812     1049700
     14DEC00    36.812    37.125    35.312    35.312      721800
     13DEC00    38.375    38.625    36.687    37.250     1048600
     12DEC00    38.687    39.437    38.000    38.625     1972200
     11DEC00    37.562    39.250    37.187    38.937     1760000
     08DEC00    36.500    37.875    35.437    37.625     1773800
     07DEC00    35.812    36.062    34.875    35.125      826900
     06DEC00    37.000    37.000    35.812    35.812     2030600
     05DEC00    34.250    37.000    34.156    36.750     3593000
     04DEC00    33.812    34.062    33.125    34.000      762900
     01DEC00    32.750    34.062    32.750    33.812      787400
     30NOV00    34.000    34.062    33.312    33.437      667400
     29NOV00    33.250    34.687    32.875    34.000     1291000
     28NOV00    33.562    34.000    33.125    33.812     1280200
     27NOV00    35.500    35.750    34.062    34.187     1146600
     24NOV00    35.000    35.687    34.875    35.375      331400
     22NOV00    36.562    36.562    34.437    34.562     1383700
     21NOV00    34.812    36.625    34.750    36.000     1751100
     20NOV00    34.375    35.000    34.250    34.562     1022200
     17NOV00    34.437    34.812    34.062    34.062     1873900
     16NOV00    34.750    34.750    33.937    34.312      927100
     15NOV00    34.750    34.937    34.187    34.687     1370100
     14NOV00    34.687    34.812    34.000    34.562     1382100
     13NOV00    32.437    34.437    32.312    34.000     2250700
     10NOV00    31.500    32.437    31.375    32.187      826800
     09NOV00    32.125    32.625    31.875    32.312     1040500
     08NOV00    32.875    33.500    32.312    32.875      458200
     07NOV00    33.312    33.312    32.250    32.875      733900
     06NOV00    31.937    33.500    31.875    32.687     1521200
     03NOV00    32.687    32.750    31.187    31.687      906000
     02NOV00    32.875    32.937    32.312    32.750      606600
     01NOV00    32.562    33.500    32.187    32.812      766400
     31OCT00    33.687    33.687    32.437    32.750     1787200
     30OCT00    31.000    34.937    31.000    33.687     2349400
     27OCT00    29.437    31.625    28.937    31.437     1001700
     26OCT00    29.062    30.625    28.250    29.812     1064100
     25OCT00    29.562    29.562    28.750    29.062      388300
     24OCT00    29.000    30.000    29.000    29.562      427500
     23OCT00    29.750    30.250    29.125    29.437      669700
     20OCT00    29.625    30.437    29.312    30.250      706700
     19OCT00    28.312    30.562    28.312    29.750     1401500
     18OCT00    28.375    28.625    27.625    27.937     1213200
     17OCT00    30.500    30.875    28.937    29.000      652500
     16OCT00    29.875    30.375    29.562    30.375      822800
     13OCT00    30.125    30.750    29.625    29.875     1008000
     12OCT00    32.437    32.437    29.812    30.500     1087700
  ; 
DATA MORE;
   INPUT DATE :DATE7. OPEN   HIGH   LOW   CLOSE  VOLUME   ADJ;
   CARDS;
 12OCT01    21.75    21.76    19.85    20.51     2386900    20.51
 15OCT01    20.51    20.89    19.63    20.27     2260100    20.27
 16OCT01    20.27    20.81    20.17    20.30     1144300    20.30
 17OCT01    20.15    20.25    19.05    19.28     1668700    19.28
 18OCT01    19.45    19.55    18.50    18.87     1824700    18.87
 19OCT01    18.87    19.00    18.25    18.47     1046800    18.47
 22OCT01    18.77    19.51    18.40    19.42     1197000    19.42
 23OCT01    19.50    20.35    19.41    19.95     1416300    19.95
 24OCT01    19.99    20.44    19.22    19.70     1482200    19.70
 25OCT01    19.70    20.15    19.28    19.98     1594000    19.98
 26OCT01    20.00    20.25    19.72    19.82     1550900    19.82
 29OCT01    19.90    19.99    19.46    19.49      623500    19.49
 30OCT01    19.05    19.35    18.71    18.99     1366800    18.99
 31OCT01    19.00    19.36    18.15    18.20     1852000    18.20
 01NOV01    18.20    18.89    18.02    18.60     1491600    18.60
 02NOV01    18.90    19.08    18.64    18.74     1335900    18.74
 05NOV01    18.74    19.16    18.56    18.90     1445800    18.90
 06NOV01    18.69    18.69    18.11    18.36     1019900    18.36
 07NOV01    18.30    18.60    18.00    18.55     1767200    18.55
 08NOV01    18.55    18.98    18.27    18.28     1547200    18.28
 09NOV01    18.30    18.50    17.70    18.13     1403100    18.13
 12NOV01    18.10    18.13    15.40    16.49     8987300    16.49  <-- crash AA flt.587
 13NOV01    16.95    17.30    16.70    17.01     3152000    17.01
 14NOV01    17.49    17.99    17.34    17.94     3030100    17.94
 15NOV01    18.45    18.95    18.10    18.75     3106700    18.75
 16NOV01    19.60    20.15    19.41    20.06     4667800    20.06
 19NOV01    20.30    20.97    20.07    20.77     3212300    20.77
  ;
DATA AMERICAN;
   SET AMERICAN MORE;
   VOLUME=VOLUME/1000000;
   LABEL VOLUME = "Volume in Millions";
   FORMAT DATE DATE7.; 
   PULSE = (DATE="17SEP01"D); 
   SHIFT = (DATE>"16SEP01"D); 
   SHIFT2 = (DATE>"11NOV01"D);
   PULSE2 = (DATE="12NOV01"D);
RUN;
PROC SORT; BY DATE; 
RUN;
DATA AMERICAN;
   SET AMERICAN END=EOF;
   T+1;
   WHERE VOLUME NE .;
   LVOLUME=LOG(VOLUME);
   OUTPUT; 
   IF EOF THEN DO TT=1 TO 40;
                  T+1;
                  DATE=DATE+1;
                  LVOLUME=.;
                  VOLUME=.;
                  DROP TT;
                  OUTPUT;
   END; 
RUN;
PROC ARIMA DATA=AMERICAN; 
    I VAR=LVOLUME NLAG=10 CROSSCOR=(PULSE PULSE2 SHIFT SHIFT2);
    E P=1 Q=1 ML INPUT=( (1)/(1) SHIFT  /(1) PULSE2 );
           ** forces second crash to have temporary effect **; 
    FORECAST LEAD=62 ID=DATE INTERVAL=DAY OUT=RESIDS BACK=42;
DATA RESIDS;
   SET RESIDS;
   VOLUME=EXP(LVOLUME);
   FORECAST=EXP(FORECAST);
RUN; 
PROC GPLOT DATA=RESIDS; 
   PLOT VOLUME*DATE FORECAST*DATE/OVERLAY HMINOR=0 VMINOR=0 VREF= 1.05 1.66
                                  HAXIS='01OCT00'D '01DEC00'D '01JAN01'D
                                        '01MAR01'D '01JUN01'D '01AUG01'D
                                        '01OCT01'D '01DEC01'D;
   SYMBOL1 V=NONE I=JOIN C=GRAY;
   SYMBOL2 V=NONE I=JOIN C=BLACK L=1 R=2;
   WHERE DATE > '01OCT00'D;
   TITLE "VOLUME";
RUN;
QUIT;

